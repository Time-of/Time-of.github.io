---
categories: [공부, 그래픽스]
tags: [그래픽스]
use_math: true
title: "[게임 그래픽스] 그래픽스 기초 이론 2"
---
# 정점 변환
정점에 행렬을 곱하여 위치를 계산하는데, 이 정점들을 화면에 출력하게 위해 거쳐야 하는 단계가 있다.  
1. **시점을 고려하지 않고** 모델을 구성하는 정점 위치 변경 → World 변환
2. **시점을 고려하여** 모델을 구성하는 정점 위치 변경 → View 변환
3. 2D 화면에 비춰짐을 고려하여 정점의 위치 변경 → Projection 변환  
<br>

위 3가지 변환을 거치게 되면, 3D 좌표들이 모두 계산되어, 우리 눈에 보이는 모니터 화면이 되는 것이다.  
정점 변환은 렌더링처럼, 매번 정점의 위치를 계산한 행렬을 곱해주는 방식으로 사용된다.  
<br>

---

# Depth Buffer
직역하면 깊이 버퍼.  
화면 상에 보이는 어떤 겹쳐진 불투명한 두 물체가 있다고 가정하자.  
이 때, 뒤에 있는 물체 B는 앞에 있는 물체 A에 의해 일부가 가려져야 한다.  
뒤에 있는 물체 B를 먼저 그리고 앞에 있는 물체 A를 그리면 될까?  
그리는 순서로써 앞뒤 구분을 한다면, B가 A를 추월해 더 앞으로 나오게 된다면 매우 어색한 상황이 나타나게 될 것이다.  
<br>

**뎁스 버퍼는 시점을 고려한 채 출력할 때, 무엇이 앞에 있는가, 뒤에 있는가를 판별하여 출력하기 위한 방법**.  
가장 가까운 '보여지고 있는 정점'의 깊이 정보를 저장하는 버퍼다.  
정점들의 깊이 정보를 저장하여, 카메라와 가장 가까운 대상의 색상으로 그리게 된다.  
<br>

모든 객체들은 깊이 값을 가지고 있다.(Z축)  
▶ (View 변환 시 모든 정점들이 카메라를 기준으로 변환되기 때문)  
뎁스 버퍼는 Z 버퍼라고 불리기도 한다.  
뎁스 버퍼를 사용하여, 만약 그리는 도중에 **겹치는 부분 발생 시, Z값이 더 낮은 색상을 사용**한다.  
이렇게 함으로써 앞에 있는 물체를 먼저 그리도록 할 수 있다.  
<br>

### Depth Fighting (Z-Fighting)
![image](https://github.com/Time-of/Time-of.github.io/assets/83389425/88f37969-1a13-4891-85a0-53bfd81ea900)  

직역하면 깊이값 싸움인데, 이는 두 물체의 Z값이 완전히 동일하여 어떤 것을 그려야 할 지 명확하게 정해지지 않아 두 물체가 서로 그려지기 위해 깜빡깜빡하며 그려지는 현상을 의미한다.  
상용 엔진에서도 서로 겹쳐있는 두 물체 간에 자주 목격할 수 있다.  
<br>

---

# Stencil Buffer
![GWIj](https://github.com/Time-of/Time-of.github.io/assets/83389425/52df467b-34d1-47f0-b4f9-eb3b816b3d6a)  
Stencil은 위 사진처럼, 일부 표면에만 색상이 묻도록 하여 어떤 패턴이나 이미지를 만드는 중간 물체다.  
스텐실 버퍼는 마치 스텐실을 사용하듯이, 특정 픽셀들이 백 버퍼에 기록되지 않도록 하여 해당 부분들이 렌더링되지 않도록 하는 버퍼다.  
거울, 그림자 등을 표현하고자 할 때 많이 사용된다.  
거울을 예로 들면, 거울에 의해 반사되는 영역'만' 물체를 그려야 하는데, 이 때 사용하기 좋다. 거울에 비치지 않는 부분까지 렌더링할 필요가 없기 때문.  

<br>

---

# 백페이스 컬링
표면: 물체의 바깥쪽 (일반적으로 보이는 부분)
이면: 물체의 안쪽
<br>

**표면만 렌더링되어야 하는 경우**: 대부분의 물체들은 표면만 렌더링하면 된다.  
**이면만 렌더링되어야 하는 경우**: Skybox 등 하늘을 표현. 표면은 렌더링할 필요가 없다.  
**표면과 이면 모두 렌더링이 필요한 경우**: 투명한 물체.  
<br>

표면과 이면을 구분해야 하는 이유가 뭘까? 둘 다 그리면 안 될까?  
→ 불필요한 Draw를 방지하기 위함.  
정상적인 게임플레이에서 절대 볼 수 없는 곳을 렌더링하는 것은 불필요하며, 사양만 잡아먹는다.  
<br>
![image](https://github.com/Time-of/Time-of.github.io/assets/83389425/16c0a99a-2b27-413e-8053-c5f5e44d5655)  
▲ 팀 포트리스 2에서 벽을 뚫고, 벽 안에 들어가 있는 사진  
<br>
벽도 마찬가지로 정상적인 게임플레이라면 벽 내부를 들어갈 수가 없기 때문에, 이면은 렌더링되지 않는다. 버그로 인해 벽 뚫기를 했을 때 내부가 훤히 다 보이는 이유.  
<br>

불필요한 렌더링을 방지하기 위해 쓰는 방법으로, **정점이 구성되는 순서**를 기준으로 표면과 이면을 구분한다.  
1. 시계 방향으로 정점을 구성한 경우 (CW, Clockwise)
2. 시계 반대 방향으로 정점을 구성한 경우 (CCW, Counterclockwise)  
<br>

CW, CCW 중 어떤 것을 표면으로 선택하면 다른 하나는 이면이 되어 그려지지 않는다. 이를 백페이스 컬링(Back-face culling)이라 한다.  
이처럼 필요 없는 부분을 그리지 않기 위한 여러 가지 컬링 방법들이 있다. (절두체 컬링, 오클루전 컬링 등)  

